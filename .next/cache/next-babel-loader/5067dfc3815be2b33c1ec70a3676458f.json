{"ast":null,"code":"import { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport React, { Fragment, useEffect, useState } from \"react\";\nimport Head from \"next/head\";\nimport Nav from \"../../components/nav\";\nimport Footer from \"../../components/footer\";\nimport Product from \"../../components/product\";\nimport IconSearch from \"../../components/icons/icon-search\";\nimport IconChevronDown from \"../../components/icons/icon-chevron-down\";\nimport { getCategories, getProducts } from \"../../api\";\nimport MiniSearch from \"minisearch\";\nimport { PRICE_FILTER_RANGES } from \"../../utils/consts\";\nimport { getServerSideCookie } from \"../../utils/serverSideStorage\";\n\nconst Products = ({\n  categories,\n  products\n}) => {\n  const {\n    0: searchText,\n    1: setSearchText\n  } = useState(\"\");\n  const {\n    0: searchProducts,\n    1: setSearchProducts\n  } = useState();\n  const {\n    0: selectedCategories,\n    1: setSelectedCategories\n  } = useState([]);\n  const {\n    0: priceRanges,\n    1: setPriceRanges\n  } = useState([]);\n  const {\n    0: filters,\n    1: setFilters\n  } = useState({\n    categories: [],\n    priceRanges: []\n  });\n  const {\n    0: sortBy,\n    1: setSortBy\n  } = useState();\n  const searchedProducts = searchProducts || products;\n  const categoryFilteredProducts = filters.categories.length > 0 ? searchedProducts.filter(item => filters.categories.find(categoryId => {\n    var _item$category;\n\n    return categoryId === (item === null || item === void 0 ? void 0 : (_item$category = item.category) === null || _item$category === void 0 ? void 0 : _item$category._id);\n  })) : searchedProducts;\n  const priceRangeFilteredProducts = filters.priceRanges.length > 0 ? categoryFilteredProducts.filter(item => filters.priceRanges.filter(index => PRICE_FILTER_RANGES[index].min <= item.price && PRICE_FILTER_RANGES[index].max >= item.price).length > 0) : categoryFilteredProducts;\n  const sortedProducts = sortBy ? priceRangeFilteredProducts.sort((a, b) => {\n    if (sortBy === \"top-rated\") {\n      return true;\n    }\n\n    if (sortBy === \"high-low\") {\n      return b.price - a.price;\n    }\n\n    if (sortBy === \"low-high\") {\n      return a.price - b.price;\n    }\n\n    return true;\n  }) : priceRangeFilteredProducts;\n\n  const onCategoryChange = (checked, id) => {\n    if (checked) {\n      setSelectedCategories(prev => [...prev, id]);\n    } else {\n      setSelectedCategories(selectedCategories.filter(item => item !== id));\n    }\n  };\n\n  const onPriceRangeChange = (checked, index) => {\n    if (checked) {\n      setPriceRanges(prev => [...prev, index]);\n    } else {\n      setPriceRanges(priceRanges.filter(item => item !== index));\n    }\n  };\n\n  const onApplyClick = () => {\n    setFilters({\n      categories: selectedCategories,\n      priceRanges: priceRanges\n    });\n  };\n\n  const onResetClick = () => {\n    setFilters({\n      categories: [],\n      priceRanges: []\n    });\n    setSelectedCategories([]);\n    setPriceRanges([]);\n  };\n\n  useEffect(() => {\n    if (searchText === \"\") {\n      setSearchProducts(null);\n      return;\n    }\n\n    const miniSearch = new MiniSearch({\n      fields: [\"name\", \"price\"],\n      idField: \"_id\"\n    });\n    miniSearch.addAll(products);\n    const searchResults = miniSearch.search(searchText, {\n      fuzzy: 0.2,\n      prefix: true\n    });\n    setSearchProducts(products.filter(product => searchResults.find(searchItem => product._id === searchItem.id)));\n  }, [searchText]);\n  return /*#__PURE__*/_jsxs(Fragment, {\n    children: [/*#__PURE__*/_jsxs(Head, {\n      children: [/*#__PURE__*/_jsx(\"title\", {\n        children: \"Products\"\n      }), /*#__PURE__*/_jsx(\"link\", {\n        rel: \"icon\",\n        href: \"/favicon.ico\"\n      })]\n    }), /*#__PURE__*/_jsx(Nav, {}), /*#__PURE__*/_jsx(\"section\", {\n      className: \"container\",\n      children: /*#__PURE__*/_jsx(\"div\", {\n        className: \"app-page-container\",\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: \"product-grid-container\",\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: \"product-filter-container\",\n            children: [/*#__PURE__*/_jsx(\"h3\", {\n              className: \"filter-title\",\n              children: \"Filters\"\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"filter-block-list\",\n              children: [/*#__PURE__*/_jsxs(\"div\", {\n                className: \"accordion-block\",\n                children: [/*#__PURE__*/_jsxs(\"div\", {\n                  className: \"accordion-heading\",\n                  children: [/*#__PURE__*/_jsx(\"span\", {\n                    children: \"Type\"\n                  }), /*#__PURE__*/_jsx(IconChevronDown, {})]\n                }), /*#__PURE__*/_jsx(\"div\", {\n                  className: \"accordion-content\",\n                  children: categories.map(item => /*#__PURE__*/_jsx(\"div\", {\n                    className: \"list-item\",\n                    children: /*#__PURE__*/_jsxs(\"label\", {\n                      className: \"checkbox-wrapper\",\n                      children: [/*#__PURE__*/_jsx(\"input\", {\n                        type: \"checkbox\",\n                        className: \"form-control\",\n                        checked: selectedCategories.includes(item._id),\n                        onChange: e => {\n                          onCategoryChange(e.target.checked, item._id);\n                        }\n                      }), item.name]\n                    })\n                  }, item._id))\n                })]\n              }), /*#__PURE__*/_jsxs(\"div\", {\n                className: \"accordion-block\",\n                children: [/*#__PURE__*/_jsxs(\"div\", {\n                  className: \"accordion-heading\",\n                  children: [/*#__PURE__*/_jsx(\"span\", {\n                    children: \"Price Range\"\n                  }), /*#__PURE__*/_jsx(IconChevronDown, {})]\n                }), /*#__PURE__*/_jsx(\"div\", {\n                  className: \"accordion-content\",\n                  children: PRICE_FILTER_RANGES.map((item, index) => /*#__PURE__*/_jsx(\"div\", {\n                    className: \"list-item\",\n                    children: /*#__PURE__*/_jsxs(\"label\", {\n                      className: \"checkbox-wrapper\",\n                      children: [/*#__PURE__*/_jsx(\"input\", {\n                        type: \"checkbox\",\n                        className: \"form-control\",\n                        checked: priceRanges.includes(index),\n                        onChange: e => {\n                          onPriceRangeChange(e.target.checked, index);\n                        }\n                      }), item.label]\n                    })\n                  }, index))\n                })]\n              })]\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"filter-actions\",\n              children: [/*#__PURE__*/_jsx(\"button\", {\n                className: \"btn primary-outline-btn\",\n                onClick: onResetClick,\n                children: \"Reset\"\n              }), /*#__PURE__*/_jsx(\"button\", {\n                className: \"btn accent-btn\",\n                onClick: onApplyClick,\n                children: \"Apply\"\n              })]\n            })]\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: \"product-list-container\",\n            children: [/*#__PURE__*/_jsxs(\"div\", {\n              className: \"product-list-heading\",\n              children: [/*#__PURE__*/_jsxs(\"div\", {\n                className: \"search-container\",\n                children: [/*#__PURE__*/_jsx(IconSearch, {}), /*#__PURE__*/_jsx(\"input\", {\n                  type: \"search\",\n                  className: \"form-control\",\n                  placeholder: \"Search\",\n                  value: searchText,\n                  onChange: e => {\n                    setSearchText(e.target.value);\n                  }\n                })]\n              }), /*#__PURE__*/_jsx(\"div\", {\n                className: \"filter-toggle\",\n                children: /*#__PURE__*/_jsx(\"button\", {\n                  className: \"btn primary-outline-btn\",\n                  children: \"Filter\"\n                })\n              }), /*#__PURE__*/_jsx(\"div\", {\n                className: \"select-container\",\n                children: /*#__PURE__*/_jsxs(\"select\", {\n                  className: \"form-control\",\n                  value: sortBy,\n                  onChange: e => setSortBy(e.target.value),\n                  children: [/*#__PURE__*/_jsx(\"option\", {\n                    children: \"Sort By\"\n                  }), /*#__PURE__*/_jsx(\"option\", {\n                    value: \"top-rated\",\n                    children: \"Top Rated\"\n                  }), /*#__PURE__*/_jsx(\"option\", {\n                    value: \"high-low\",\n                    children: \"Price: High to Low\"\n                  }), /*#__PURE__*/_jsx(\"option\", {\n                    value: \"low-high\",\n                    children: \"Price: Low to High\"\n                  })]\n                })\n              })]\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: \"product-block\",\n              children: sortedProducts.map((item, index) => /*#__PURE__*/_jsx(Product, {\n                data: item\n              }, index))\n            })]\n          })]\n        })\n      })\n    }), /*#__PURE__*/_jsx(Footer, {})]\n  });\n};\n\nexport default Products;\nexport const getServerSideProps = async context => {\n  const token = getServerSideCookie(context)(\"token\");\n\n  try {\n    const products = await getProducts(token)();\n    const categories = await getCategories(token)();\n    return {\n      props: {\n        categories,\n        products\n      }\n    };\n  } catch (e) {\n    console.log(\"error\", e.message);\n  }\n\n  return {\n    props: {\n      categories: [],\n      products: []\n    }\n  };\n};","map":null,"metadata":{},"sourceType":"module"}