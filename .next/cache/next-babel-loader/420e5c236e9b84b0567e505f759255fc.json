{"ast":null,"code":"import React, { Fragment, useEffect, useState } from \"react\";\nimport Head from \"next/head\";\nimport Nav from \"../../components/nav\";\nimport Footer from \"../../components/footer\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faArrowLeft } from \"@fortawesome/free-solid-svg-icons/faArrowLeft\";\nimport { useCartActions, useCartState } from \"../../contexts/CartContext\";\nimport { captureOrder, createPayPalTransaction } from \"../../api\";\nimport Image from \"next/image\";\nimport { PRODUCT_IMAGE_FILLER } from \"../../utils/consts\";\nimport { useRouter } from \"next/router\";\nimport { useAuth } from \"../../contexts/AuthContext\";\nimport { PulseLoader } from \"react-spinners\";\nimport { useToasts } from \"react-toast-notifications\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\n\nconst paypal_load = (onLoad = () => {}) => {\n  const aScript = document.createElement(\"script\");\n  aScript.type = \"text/javascript\";\n  aScript.src = \"https://www.paypal.com/sdk/js?client-id=Ac1N1G72VYm_9nP3q3KFWX_RCfpUZkwLbRcUI8_NrerFWVSBDvDRXGYKoSNYLdKiYC_C7_gOT6R2Yy-Q&currency=USD\";\n  document.head.appendChild(aScript);\n  aScript.onload = onLoad;\n};\n\nconst Checkout = () => {\n  const cart = useCartState();\n  const {\n    clearCart\n  } = useCartActions();\n  const {\n    authenticated\n  } = useAuth();\n  const router = useRouter();\n  const {\n    addToast\n  } = useToasts();\n  const {\n    0: isSubmitting,\n    1: setIsSubmitting\n  } = useState(false);\n  useEffect(() => {\n    paypal_load(() => {\n      window.paypal.Buttons({\n        createOrder: function () {\n          return createPayPalTransaction()({\n            total_amount: cart === null || cart === void 0 ? void 0 : cart.total_amount\n          }).then(data => {\n            return data.result.id;\n          });\n        },\n        onApprove: function (data, actions) {\n          return captureOrder()({\n            paypal_order_id: data.orderID,\n            order: cart\n          }).then(response => {\n            if (response.error === \"INSTRUMENT_DECLINED\") {\n              return actions.restart();\n            }\n\n            clearCart();\n            router.push(\"/products\");\n          });\n        }\n      }).render(\"#paypal-button-container\");\n    });\n  }, []);\n\n  if (!authenticated) {\n    return /*#__PURE__*/_jsxs(Fragment, {\n      children: [/*#__PURE__*/_jsxs(Head, {\n        children: [/*#__PURE__*/_jsx(\"title\", {\n          children: \"Checkout\"\n        }), /*#__PURE__*/_jsx(\"link\", {\n          rel: \"icon\",\n          href: \"/favicon.ico\"\n        })]\n      }), /*#__PURE__*/_jsx(Nav, {}), /*#__PURE__*/_jsx(\"section\", {\n        className: \"container\",\n        children: /*#__PURE__*/_jsx(\"div\", {\n          className: \"app-page-container\",\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: \"info-container\",\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: \"login-required\"\n            }), /*#__PURE__*/_jsx(\"h3\", {\n              className: \"text-center\",\n              children: \"Please login to continue.\"\n            })]\n          })\n        })\n      })]\n    });\n  }\n\n  return /*#__PURE__*/_jsxs(Fragment, {\n    children: [/*#__PURE__*/_jsxs(Head, {\n      children: [/*#__PURE__*/_jsx(\"title\", {\n        children: \"Checkout\"\n      }), /*#__PURE__*/_jsx(\"link\", {\n        rel: \"icon\",\n        href: \"/favicon.ico\"\n      })]\n    }), /*#__PURE__*/_jsx(Nav, {}), /*#__PURE__*/_jsx(\"section\", {\n      className: \"container\",\n      children: /*#__PURE__*/_jsxs(\"div\", {\n        className: \"app-page-container\",\n        children: [/*#__PURE__*/_jsx(\"h4\", {\n          className: \"mb-2\",\n          children: \"Checkout\"\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"cart-item-container checkout-page\",\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: \"cart-item-header\",\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: \"product-name\",\n              children: \"Product\"\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: \"product-price\",\n              children: \"Product Price\"\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: \"product-qty\",\n              children: \"Quantity\"\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: \"total-amount\",\n              children: \"Total Amount\"\n            })]\n          }), cart.items.map(({\n            name,\n            price,\n            quantity,\n            total_amount,\n            images\n          }, index) => {\n            var _images$;\n\n            return /*#__PURE__*/_jsxs(\"div\", {\n              className: \"cart-item\",\n              children: [/*#__PURE__*/_jsx(\"div\", {\n                className: \"product-image\",\n                children: /*#__PURE__*/_jsx(Image, {\n                  src: (images === null || images === void 0 ? void 0 : (_images$ = images[0]) === null || _images$ === void 0 ? void 0 : _images$.url) || PRODUCT_IMAGE_FILLER,\n                  alt: name,\n                  layout: \"fill\"\n                })\n              }), /*#__PURE__*/_jsx(\"div\", {\n                className: \"product-name\",\n                children: /*#__PURE__*/_jsx(\"span\", {\n                  children: name\n                })\n              }), /*#__PURE__*/_jsxs(\"div\", {\n                className: \"product-price\",\n                children: [\"$\", price]\n              }), /*#__PURE__*/_jsx(\"div\", {\n                className: \"product-qty\",\n                children: quantity\n              }), /*#__PURE__*/_jsxs(\"div\", {\n                className: \"total-amount\",\n                children: [\"$\", total_amount]\n              })]\n            }, index);\n          })]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"checkout-container paypal-container\",\n          children: [/*#__PURE__*/_jsxs(\"button\", {\n            className: \"btn primary-outline-btn checkout-btn\",\n            onClick: () => router.push(\"/cart\"),\n            children: [/*#__PURE__*/_jsx(FontAwesomeIcon, {\n              icon: faArrowLeft,\n              size: \"2x\"\n            }), \"Back to Cart\"]\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            style: {\n              display: \"flex\",\n              alignItems: \"center\"\n            },\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              children: /*#__PURE__*/_jsxs(\"button\", {\n                className: \"btn accent-btn\",\n                onClick: () => {\n                  setIsSubmitting(true);\n                  captureOrder()({\n                    paypal_order_id: null,\n                    order: cart\n                  }).then(() => {\n                    addToast(\"Order checkout successfully.\", {\n                      appearance: \"success\"\n                    });\n                    clearCart();\n                    router.push(\"/products\");\n                  }).catch(err => {\n                    addToast((err === null || err === void 0 ? void 0 : err.message) || \"Error while checking out.\", {\n                      appearance: \"error\"\n                    });\n                  }).finally(() => {\n                    setIsSubmitting(false);\n                  });\n                },\n                disabled: isSubmitting,\n                children: [\"Pay on delivery\", \" \", /*#__PURE__*/_jsx(PulseLoader, {\n                  loading: isSubmitting,\n                  size: 4\n                })]\n              })\n            }), /*#__PURE__*/_jsx(\"div\", {\n              style: {\n                marginLeft: \"16px\"\n              },\n              children: /*#__PURE__*/_jsx(\"div\", {\n                id: \"paypal-button-container\"\n              })\n            })]\n          })]\n        })]\n      })\n    }), /*#__PURE__*/_jsx(Footer, {})]\n  });\n};\n\nexport default Checkout;","map":null,"metadata":{},"sourceType":"module"}