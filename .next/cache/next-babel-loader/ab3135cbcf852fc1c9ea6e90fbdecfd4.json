{"ast":null,"code":"var _jsxFileName = \"/home/anuz/work/personal/creation-arts/pages/products/index.js\";\nimport React, { Fragment, useEffect, useState } from \"react\";\nimport Head from \"next/head\";\nimport Nav from \"../../components/nav\";\nimport Footer from \"../../components/footer\";\nimport Product from \"../../components/product\";\nimport IconSearch from \"../../components/icons/icon-search\";\nimport IconChevronDown from \"../../components/icons/icon-chevron-down\";\nimport { getCategories, getProducts } from \"../../api\";\nimport MiniSearch from \"minisearch\";\nimport { PRICE_FILTER_RANGES } from \"../../utils/consts\";\nimport { getServerSideCookie } from \"../../utils/serverSideStorage\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Products = ({\n  categories,\n  products\n}) => {\n  const {\n    0: searchText,\n    1: setSearchText\n  } = useState(\"\");\n  const {\n    0: searchProducts,\n    1: setSearchProducts\n  } = useState();\n  const {\n    0: selectedCategories,\n    1: setSelectedCategories\n  } = useState([]);\n  const {\n    0: priceRanges,\n    1: setPriceRanges\n  } = useState([]);\n  const {\n    0: filters,\n    1: setFilters\n  } = useState({\n    categories: [],\n    priceRanges: []\n  });\n  const {\n    0: sortBy,\n    1: setSortBy\n  } = useState();\n  const searchedProducts = searchProducts || products;\n  const categoryFilteredProducts = filters.categories.length > 0 ? searchedProducts.filter(item => filters.categories.find(categoryId => {\n    var _item$category;\n\n    return categoryId === (item === null || item === void 0 ? void 0 : (_item$category = item.category) === null || _item$category === void 0 ? void 0 : _item$category._id);\n  })) : searchedProducts;\n  const priceRangeFilteredProducts = filters.priceRanges.length > 0 ? categoryFilteredProducts.filter(item => filters.priceRanges.filter(index => PRICE_FILTER_RANGES[index].min <= item.price && PRICE_FILTER_RANGES[index].max >= item.price).length > 0) : categoryFilteredProducts;\n  const sortedProducts = sortBy ? priceRangeFilteredProducts.sort((a, b) => {\n    if (sortBy === \"top-rated\") {\n      return true;\n    }\n\n    if (sortBy === \"high-low\") {\n      return b.price - a.price;\n    }\n\n    if (sortBy === \"low-high\") {\n      return a.price - b.price;\n    }\n\n    return true;\n  }) : priceRangeFilteredProducts;\n\n  const onCategoryChange = (checked, id) => {\n    if (checked) {\n      setSelectedCategories(prev => [...prev, id]);\n    } else {\n      setSelectedCategories(selectedCategories.filter(item => item !== id));\n    }\n  };\n\n  const onPriceRangeChange = (checked, index) => {\n    if (checked) {\n      setPriceRanges(prev => [...prev, index]);\n    } else {\n      setPriceRanges(priceRanges.filter(item => item !== index));\n    }\n  };\n\n  const onApplyClick = () => {\n    setFilters({\n      categories: selectedCategories,\n      priceRanges: priceRanges\n    });\n  };\n\n  const onResetClick = () => {\n    setFilters({\n      categories: [],\n      priceRanges: []\n    });\n    setSelectedCategories([]);\n    setPriceRanges([]);\n  };\n\n  useEffect(() => {\n    if (searchText === \"\") {\n      setSearchProducts(null);\n      return;\n    }\n\n    const miniSearch = new MiniSearch({\n      fields: [\"name\", \"price\"],\n      idField: \"_id\"\n    });\n    miniSearch.addAll(products);\n    const searchResults = miniSearch.search(searchText, {\n      fuzzy: 0.2,\n      prefix: true\n    });\n    setSearchProducts(products.filter(product => searchResults.find(searchItem => product._id === searchItem.id)));\n  }, [searchText]);\n  return /*#__PURE__*/_jsxDEV(Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Head, {\n      children: [/*#__PURE__*/_jsxDEV(\"title\", {\n        children: \"Products\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"link\", {\n        rel: \"icon\",\n        href: \"/favicon.ico\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"meta\", {\n        property: \"title\",\n        content: \"Best-priced handicraft products from Nepal | Yala Treasure\"\n      }, \"product_title\", false, {\n        fileName: _jsxFileName,\n        lineNumber: 112,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"meta\", {\n        property: \"description\",\n        content: \"Yala Treasure - an online shopping platform for Nepali arts and crafts. Buy all kinds of unique, local, and best-priced handicraft products made in Nepal now!\"\n      }, \"product_description\", false, {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Nav, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"section\", {\n      className: \"container\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"app-page-container\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"product-grid-container\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"product-filter-container\",\n            children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n              className: \"filter-title\",\n              children: \"Filters\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 123,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"filter-block-list\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"accordion-block\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"accordion-heading\",\n                  children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                    children: \"Type\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 127,\n                    columnNumber: 41\n                  }, this), /*#__PURE__*/_jsxDEV(IconChevronDown, {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 128,\n                    columnNumber: 41\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 126,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"accordion-content\",\n                  children: categories.map(item => /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"list-item\",\n                    children: /*#__PURE__*/_jsxDEV(\"label\", {\n                      className: \"checkbox-wrapper\",\n                      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                        type: \"checkbox\",\n                        className: \"form-control\",\n                        checked: selectedCategories.includes(item._id),\n                        onChange: e => {\n                          onCategoryChange(e.target.checked, item._id);\n                        }\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 134,\n                        columnNumber: 53\n                      }, this), item.name]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 133,\n                      columnNumber: 49\n                    }, this)\n                  }, item._id, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 132,\n                    columnNumber: 45\n                  }, this))\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 130,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 125,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"accordion-block\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"accordion-heading\",\n                  children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                    children: \"Price Range\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 150,\n                    columnNumber: 41\n                  }, this), /*#__PURE__*/_jsxDEV(IconChevronDown, {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 151,\n                    columnNumber: 41\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 149,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"accordion-content\",\n                  children: PRICE_FILTER_RANGES.map((item, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"list-item\",\n                    children: /*#__PURE__*/_jsxDEV(\"label\", {\n                      className: \"checkbox-wrapper\",\n                      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                        type: \"checkbox\",\n                        className: \"form-control\",\n                        checked: priceRanges.includes(index),\n                        onChange: e => {\n                          onPriceRangeChange(e.target.checked, index);\n                        }\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 157,\n                        columnNumber: 53\n                      }, this), item.label]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 156,\n                      columnNumber: 49\n                    }, this)\n                  }, index, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 155,\n                    columnNumber: 45\n                  }, this))\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 153,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 148,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 124,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"filter-actions\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"btn primary-outline-btn\",\n                onClick: onResetClick,\n                children: \"Reset\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 173,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"btn accent-btn\",\n                onClick: onApplyClick,\n                children: \"Apply\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 179,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 172,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 122,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"product-list-container\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"product-list-heading\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"search-container\",\n                children: [/*#__PURE__*/_jsxDEV(IconSearch, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 187,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"search\",\n                  className: \"form-control\",\n                  placeholder: \"Search\",\n                  value: searchText,\n                  onChange: e => {\n                    setSearchText(e.target.value);\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 188,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 186,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"filter-toggle\",\n                children: /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"btn primary-outline-btn\",\n                  children: \"Filter\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 199,\n                  columnNumber: 37\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 198,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"select-container\",\n                children: /*#__PURE__*/_jsxDEV(\"select\", {\n                  className: \"form-control\",\n                  value: sortBy,\n                  onChange: e => setSortBy(e.target.value),\n                  children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                    children: \"Sort By\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 207,\n                    columnNumber: 41\n                  }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                    value: \"top-rated\",\n                    children: \"Top Rated\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 208,\n                    columnNumber: 41\n                  }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                    value: \"high-low\",\n                    children: \"Price: High to Low\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 209,\n                    columnNumber: 41\n                  }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                    value: \"low-high\",\n                    children: \"Price: Low to High\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 210,\n                    columnNumber: 41\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 202,\n                  columnNumber: 37\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 201,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 185,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"product-block\",\n              children: sortedProducts.map((item, index) => /*#__PURE__*/_jsxDEV(Product, {\n                data: item\n              }, index, false, {\n                fileName: _jsxFileName,\n                lineNumber: 216,\n                columnNumber: 37\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 214,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 121,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 108,\n    columnNumber: 9\n  }, this);\n};\n\nexport default Products;\nexport const getServerSideProps = async context => {\n  const token = getServerSideCookie(context)(\"token\");\n\n  try {\n    const products = await getProducts(token)();\n    const categories = await getCategories(token)();\n    return {\n      props: {\n        categories,\n        products\n      }\n    };\n  } catch (e) {\n    console.log(\"error\", e.message);\n  }\n\n  return {\n    props: {\n      categories: [],\n      products: []\n    }\n  };\n};","map":{"version":3,"sources":["/home/anuz/work/personal/creation-arts/pages/products/index.js"],"names":["React","Fragment","useEffect","useState","Head","Nav","Footer","Product","IconSearch","IconChevronDown","getCategories","getProducts","MiniSearch","PRICE_FILTER_RANGES","getServerSideCookie","Products","categories","products","searchText","setSearchText","searchProducts","setSearchProducts","selectedCategories","setSelectedCategories","priceRanges","setPriceRanges","filters","setFilters","sortBy","setSortBy","searchedProducts","categoryFilteredProducts","length","filter","item","find","categoryId","category","_id","priceRangeFilteredProducts","index","min","price","max","sortedProducts","sort","a","b","onCategoryChange","checked","id","prev","onPriceRangeChange","onApplyClick","onResetClick","miniSearch","fields","idField","addAll","searchResults","search","fuzzy","prefix","product","searchItem","map","includes","e","target","name","label","value","getServerSideProps","context","token","props","console","log","message"],"mappings":"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","sourcesContent":["import React, {Fragment, useEffect, useState} from \"react\";\nimport Head from \"next/head\";\nimport Nav from \"../../components/nav\";\nimport Footer from \"../../components/footer\";\nimport Product from \"../../components/product\";\nimport IconSearch from \"../../components/icons/icon-search\";\nimport IconChevronDown from \"../../components/icons/icon-chevron-down\";\nimport {getCategories, getProducts} from \"../../api\";\nimport MiniSearch from \"minisearch\";\nimport {PRICE_FILTER_RANGES} from \"../../utils/consts\";\nimport {getServerSideCookie} from \"../../utils/serverSideStorage\";\n\nconst Products = ({categories, products}) => {\n    const [searchText, setSearchText] = useState(\"\");\n    const [searchProducts, setSearchProducts] = useState();\n    const [selectedCategories, setSelectedCategories] = useState([]);\n    const [priceRanges, setPriceRanges] = useState([]);\n    const [filters, setFilters] = useState({categories: [], priceRanges: []});\n    const [sortBy, setSortBy] = useState();\n\n    const searchedProducts = searchProducts || products;\n\n    const categoryFilteredProducts =\n        filters.categories.length > 0\n            ? searchedProducts.filter((item) =>\n                filters.categories.find(\n                    (categoryId) => categoryId === item?.category?._id\n                )\n            )\n            : searchedProducts;\n\n    const priceRangeFilteredProducts =\n        filters.priceRanges.length > 0\n            ? categoryFilteredProducts.filter(\n                (item) =>\n                    filters.priceRanges.filter(\n                        (index) =>\n                            PRICE_FILTER_RANGES[index].min <= item.price &&\n                            PRICE_FILTER_RANGES[index].max >= item.price\n                    ).length > 0\n            )\n            : categoryFilteredProducts;\n\n    const sortedProducts = sortBy\n        ? priceRangeFilteredProducts.sort((a, b) => {\n            if (sortBy === \"top-rated\") {\n                return true;\n            }\n            if (sortBy === \"high-low\") {\n                return b.price - a.price;\n            }\n            if (sortBy === \"low-high\") {\n                return a.price - b.price;\n            }\n\n            return true;\n        })\n        : priceRangeFilteredProducts;\n\n    const onCategoryChange = (checked, id) => {\n        if (checked) {\n            setSelectedCategories((prev) => [...prev, id]);\n        } else {\n            setSelectedCategories(selectedCategories.filter((item) => item !== id));\n        }\n    };\n\n    const onPriceRangeChange = (checked, index) => {\n        if (checked) {\n            setPriceRanges((prev) => [...prev, index]);\n        } else {\n            setPriceRanges(priceRanges.filter((item) => item !== index));\n        }\n    };\n\n    const onApplyClick = () => {\n        setFilters({categories: selectedCategories, priceRanges: priceRanges});\n    };\n\n    const onResetClick = () => {\n        setFilters({categories: [], priceRanges: []});\n        setSelectedCategories([]);\n        setPriceRanges([]);\n    };\n\n    useEffect(() => {\n        if (searchText === \"\") {\n            setSearchProducts(null);\n            return;\n        }\n        const miniSearch = new MiniSearch({\n            fields: [\"name\", \"price\"],\n            idField: \"_id\",\n        });\n        miniSearch.addAll(products);\n        const searchResults = miniSearch.search(searchText, {\n            fuzzy: 0.2,\n            prefix: true,\n        });\n        setSearchProducts(\n            products.filter((product) =>\n                searchResults.find((searchItem) => product._id === searchItem.id)\n            )\n        );\n    }, [searchText]);\n\n    return (\n        <Fragment>\n            <Head>\n                <title>Products</title>\n                <link rel=\"icon\" href=\"/favicon.ico\"/>\n                <meta property={\"title\"} content={\"Best-priced handicraft products from Nepal | Yala Treasure\"}\n                      key={\"product_title\"}/>\n                <meta property={\"description\"}\n                      content={\"Yala Treasure - an online shopping platform for Nepali arts and crafts. Buy all kinds of unique, local, and best-priced handicraft products made in Nepal now!\"}\n                      key={\"product_description\"}/>\n            </Head>\n            <Nav/>\n            <section className=\"container\">\n                <div className=\"app-page-container\">\n                    <div className=\"product-grid-container\">\n                        <div className=\"product-filter-container\">\n                            <h3 className=\"filter-title\">Filters</h3>\n                            <div className=\"filter-block-list\">\n                                <div className=\"accordion-block\">\n                                    <div className=\"accordion-heading\">\n                                        <span>Type</span>\n                                        <IconChevronDown/>\n                                    </div>\n                                    <div className=\"accordion-content\">\n                                        {categories.map((item) => (\n                                            <div className=\"list-item\" key={item._id}>\n                                                <label className=\"checkbox-wrapper\">\n                                                    <input\n                                                        type=\"checkbox\"\n                                                        className=\"form-control\"\n                                                        checked={selectedCategories.includes(item._id)}\n                                                        onChange={(e) => {\n                                                            onCategoryChange(e.target.checked, item._id);\n                                                        }}\n                                                    />\n                                                    {item.name}\n                                                </label>\n                                            </div>\n                                        ))}\n                                    </div>\n                                </div>\n                                <div className=\"accordion-block\">\n                                    <div className=\"accordion-heading\">\n                                        <span>Price Range</span>\n                                        <IconChevronDown/>\n                                    </div>\n                                    <div className=\"accordion-content\">\n                                        {PRICE_FILTER_RANGES.map((item, index) => (\n                                            <div className=\"list-item\" key={index}>\n                                                <label className=\"checkbox-wrapper\">\n                                                    <input\n                                                        type=\"checkbox\"\n                                                        className=\"form-control\"\n                                                        checked={priceRanges.includes(index)}\n                                                        onChange={(e) => {\n                                                            onPriceRangeChange(e.target.checked, index);\n                                                        }}\n                                                    />\n                                                    {item.label}\n                                                </label>\n                                            </div>\n                                        ))}\n                                    </div>\n                                </div>\n                            </div>\n                            <div className=\"filter-actions\">\n                                <button\n                                    className=\"btn primary-outline-btn\"\n                                    onClick={onResetClick}\n                                >\n                                    Reset\n                                </button>\n                                <button className=\"btn accent-btn\" onClick={onApplyClick}>\n                                    Apply\n                                </button>\n                            </div>\n                        </div>\n                        <div className=\"product-list-container\">\n                            <div className=\"product-list-heading\">\n                                <div className=\"search-container\">\n                                    <IconSearch/>\n                                    <input\n                                        type=\"search\"\n                                        className={\"form-control\"}\n                                        placeholder={\"Search\"}\n                                        value={searchText}\n                                        onChange={(e) => {\n                                            setSearchText(e.target.value);\n                                        }}\n                                    />\n                                </div>\n                                <div className=\"filter-toggle\">\n                                    <button className=\"btn primary-outline-btn\">Filter</button>\n                                </div>\n                                <div className=\"select-container\">\n                                    <select\n                                        className=\"form-control\"\n                                        value={sortBy}\n                                        onChange={(e) => setSortBy(e.target.value)}\n                                    >\n                                        <option>Sort By</option>\n                                        <option value={\"top-rated\"}>Top Rated</option>\n                                        <option value={\"high-low\"}>Price: High to Low</option>\n                                        <option value={\"low-high\"}>Price: Low to High</option>\n                                    </select>\n                                </div>\n                            </div>\n                            <div className=\"product-block\">\n                                {sortedProducts.map((item, index) => (\n                                    <Product key={index} data={item}/>\n                                ))}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </section>\n            <Footer/>\n        </Fragment>\n    );\n};\n\nexport default Products;\n\nexport const getServerSideProps = async (context) => {\n    const token = getServerSideCookie(context)(\"token\");\n\n    try {\n        const products = await getProducts(token)();\n        const categories = await getCategories(token)();\n        return {props: {categories, products}};\n    } catch (e) {\n        console.log(\"error\", e.message);\n    }\n    return {props: {categories: [], products: []}};\n};\n\n\n"]},"metadata":{},"sourceType":"module"}